reader.service("CelCroSvc",["$window","tarotDeck",function(t,o){function e(t,o,e){t.ray.origin.copy(s.position),t.ray.direction.set(o.x,o.y,.5).unproject(s).sub(s.position).normalize()}function i(t){if(n.activeCard=t.object,m){for(refCard in a)m.object.name==a[refCard].name&&(t.object.name==a[1].name?u.to(m.object.position,1,a[refCard].position).to(".overlay",1,{opacity:"0"},"-=1").to(t.object.rotation,1,{x:Math.PI,y:Math.PI,z:Math.PI/2},"-=1").to(p.material,.7,{opacity:0},"-=1").to(p.position,.1,{z:-1}).to(".overlay",1,{visibility:"hidden"}):u.to(m.object.position,1,a[refCard].position).to(".overlay",1,{opacity:"0"},"-=1").to(p.material,.7,{opacity:0},"-=1").to(p.position,.1,{z:-1}).to(".overlay",1,{visibility:"hidden"}));m=null}else t.object.name==a[1].name?u.to(t.object.position,1,{x:-25,y:0,z:t.object.position.z+120}).to(".overlay",1,{visibility:"visible",opacity:"1"},"-=1").to(t.object.rotation,1,{x:0,y:0,z:0},"-=1").to(p.position,.2,{z:1},"-=1").to(p.material,1,{opacity:.7},"-=1"):u.to(t.object.position,1,{x:-25,y:0,z:t.object.position.z+120}).to(".overlay",1,{visibility:"visible",opacity:"1"},"-=1").to(p.position,.2,{z:1},"-=1").to(p.material,1,{opacity:.7},"-=1"),m=t}var n=o.deck,a=o.shuffledDeck(),s,r,p,h=[],c=t.innerWidth/2,l=t.innerHeight/2,d=new THREE.Raycaster,y,f=new THREE.Vector2,m=null,u=new TimelineLite,b=!1,E=this,v=new THREE.WebGLRenderer({antialias:!0,autoClear:!0});this.mouse=f,this.renderer=v,this.init=function(){a=o.shuffledDeck(),a[0].position={x:-20,y:0,z:0},a[1].position={x:-20,y:0,z:.5},a[2].position={x:-20,y:-30,z:0},a[3].position={x:-50,y:0,z:0},a[4].position={x:-20,y:30,z:0},a[5].position={x:10,y:0,z:0},a[6].position={x:50,y:-40,z:0},a[7].position={x:50,y:-15,z:0},a[8].position={x:50,y:10,z:0},a[9].position={x:50,y:35,z:0},a[0].posInfo="the general atmosphere thta surrounds the question asked; the influences at work around it",a[1].posInfo="what the opposing forces may be, for good or evil",a[2].posInfo="the foundation or basis of the matter; something that has already become part of the subject's experience",a[3].posInfo="the influence that has just passed or is now passing away",a[4].posInfo="an influence that <i>may</i> come into being",a[5].posInfo="the influence that will operate in the near future",a[6].posInfo="the negative feelings, the fears the subject has on the matter",a[7].posInfo="the subject's environment, the opinions and influence of family and friends",a[8].posInfo="the subject's own hopes and ideals in the matter",a[9].posInfo="the outcome of the matter - the cumulative result of the influences exerted by the other cards. It includes all that has been divined from the other cards on the table.",v.setClearColor(16777215),v.setSize(t.innerWidth/12*10,t.innerHeight/12*10),$("#container-celtic-cross").append(v.domElement),r=new THREE.Scene,s=new THREE.PerspectiveCamera(35,t.innerWidth/t.innerHeight,1,1e4),s.position.set(0,0,175),r.add(s);var e=new THREE.AmbientLight(16777215);e.position.set(0,0,20),r.add(e);for(var i=new THREE.BoxGeometry(14,24,.2),n=[],h=(new THREE.TextureLoader).load(a[0].image),c=new THREE.MeshBasicMaterial({map:h}),l=0;10>l;l++){var d=(new THREE.TextureLoader).load(a[l].image),y=new THREE.MeshBasicMaterial({map:d}),f=new THREE.Mesh(i,y);f.position.set(-150,50,50),f.rotation.y=Math.PI/2,f.name=a[l].name,f.selected=!1,f.PKT=a[l].PKT,f.posInfo=a[l].posInfo,n.push(f),r.add(f)}u.to(n[0].position,1,a[0].position).to(n[0].rotation,1,{y:Math.PI},"-=1").to(n[1].position,1,a[1].position).to(n[1].rotation,1,{x:Math.PI,y:Math.PI,z:Math.PI/2},"-=1").to(n[2].position,1,a[2].position).to(n[2].rotation,1,{y:Math.PI},"-=1").to(n[3].position,1,a[3].position).to(n[3].rotation,1,{y:Math.PI},"-=1").to(n[4].position,1,a[4].position).to(n[4].rotation,1,{y:Math.PI},"-=1").to(n[5].position,1,a[5].position).to(n[5].rotation,1,{y:Math.PI},"-=1").to(n[6].position,1,a[6].position).to(n[6].rotation,1,{y:Math.PI},"-=1").to(n[7].position,1,a[7].position).to(n[7].rotation,1,{y:Math.PI},"-=1").to(n[8].position,1,a[8].position).to(n[8].rotation,1,{y:Math.PI},"-=1").to(n[9].position,1,a[9].position).to(n[9].rotation,1,{y:Math.PI},"-=1");var m=new THREE.PlaneGeometry(t.innerWidth/12*10,t.innerHeight/12*10),b=new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:0});p=new THREE.Mesh(m,b),p.name="overlay",p.position.set(0,0,-1),r.add(p)},$(t).resize(function(){s.aspect=t.innerWidth/t.innerHeight,s.updateProjectionMatrix(),v.setSize(t.innerWidth/12*10,t.innerHeight/12*10)}),this.intersect=function(t){e(d,f,s);var o=d.intersectObjects(r.children);o.length>0&&i(o[0])};var I=function(){s.position.x=20*f.x,s.position.y=20*f.y,s.lookAt(r.position),E.reqFr=requestAnimationFrame(I),v.render(r,s)};this.render=I,this.destroyScene=function(){cancelAnimationFrame(this.reqFr)}}]);