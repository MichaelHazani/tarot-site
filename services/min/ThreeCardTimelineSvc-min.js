reader.service("ThreeCardTimelineSvc",["$window","tarotDeck",function(e,i){function t(e,i,t){e.ray.origin.copy(a.position),e.ray.direction.set(i.x,i.y,.5).unproject(a).sub(a.position).normalize()}function o(e){if(n.activeCard=e.object,m){for(refCard in r)m.object.name==r[refCard].name&&u.to(m.object.position,1,r[refCard].position).to(".overlay",1,{opacity:"0"},"-=1").to(c.material,.7,{opacity:0},"-=1").to(c.position,.1,{z:-1}).to(".overlay",1,{visibility:"hidden"});m=null}else m=e,u.to(e.object.position,1,{x:-20,z:e.object.position.z+30}).to(".overlay",1,{visibility:"visible",opacity:"1"},"-=1").to(c.position,.2,{z:1},"-=1").to(c.material,1,{opacity:.7},"-=1")}var n=i.deck,r=i.shuffledDeck(),a,s,c,p=[],d=e.innerWidth/2,h=e.innerHeight/2,l=new THREE.Raycaster,E,y=new THREE.Vector2,m=null,u=new TimelineLite,T=!1,f=this,H=new THREE.WebGLRenderer({antialias:!0,autoClear:!0});this.mouse=y,this.renderer=H,this.init=function(){r[0].position={x:-30,y:0,z:0},r[1].position={x:0,y:0,z:0},r[2].position={x:30,y:0,z:0},r[0].posInfo="the Past",r[1].posInfo="the Present",r[2].posInfo="the Future",H.setClearColor(16777215),H.setSize(e.innerWidth/12*10,e.innerHeight/12*10),$("#container-three-tl").append(H.domElement),s=new THREE.Scene,a=new THREE.PerspectiveCamera(35,e.innerWidth/e.innerHeight,1,1e4),a.position.set(0,0,75),s.add(a);var i=new THREE.AmbientLight(16777215);i.position.set(0,0,20),s.add(i);for(var t=new THREE.BoxGeometry(14,24,.2),o=[],n=(new THREE.TextureLoader).load(r[0].image),p=new THREE.MeshBasicMaterial({map:n}),d=0;3>d;d++){var h=(new THREE.TextureLoader).load(r[d].image),l=new THREE.MeshBasicMaterial({map:h}),E=new THREE.Mesh(t,l);E.position.set(-30,10,50),E.rotation.y=Math.PI/2,E.name=r[d].name,E.PKT=r[d].PKT,E.posInfo=r[d].posInfo,E.selected=!1,o.push(E),s.add(E)}u.to(o[0].position,1,r[0].position).to(o[0].rotation,1,{y:Math.PI},"-=1").to(o[1].position,1,r[1].position).to(o[1].rotation,1,{y:Math.PI},"-=1").to(o[2].position,1,r[2].position).to(o[2].rotation,1,{y:Math.PI},"-=1");var y=new THREE.PlaneGeometry(e.innerWidth/12*10,e.innerHeight/12*10),m=new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:0});c=new THREE.Mesh(y,m),c.name="overlay",c.position.set(0,0,-1),s.add(c)},$(e).resize(function(){a.aspect=e.innerWidth/e.innerHeight,a.updateProjectionMatrix(),H.setSize(e.innerWidth/12*10,e.innerHeight/12*10)}),this.intersect=function(e){t(l,y,a);var i=l.intersectObjects(s.children);i.length>0&&o(i[0])};var v=function(){a.position.x=20*y.x,a.position.y=20*y.y,a.lookAt(s.position),f.reqFr=requestAnimationFrame(v),H.render(s,a)};this.render=v,this.destroyScene=function(){cancelAnimationFrame(this.reqFr)}}]);