reader.service("ThreeCardSitSvc",["$window","tarotDeck",function(e,i){function t(e,i,t){e.ray.origin.copy(a.position),e.ray.direction.set(i.x,i.y,.5).unproject(a).sub(a.position).normalize()}function o(e){if(n.activeCard=e.object,m){for(refCard in r)m.object.name==r[refCard].name&&u.to(m.object.position,1,r[refCard].position).to(".overlay",1,{opacity:"0"},"-=1").to(c.material,.7,{opacity:0},"-=1").to(c.position,.1,{z:-1}).to(".overlay",1,{visibility:"hidden"});m=null}else m=e,u.to(e.object.position,1,{x:-20,z:e.object.position.z+30}).to(".overlay",1,{visibility:"visible",opacity:"1"},"-=1").to(c.position,.2,{z:1},"-=1").to(c.material,1,{opacity:.7},"-=1")}var n=i.deck,r=i.shuffledDeck(),a,s,c,p=[],d=e.innerWidth/2,h=e.innerHeight/2,l=new THREE.Raycaster,y,E=new THREE.Vector2,m=null,u=new TimelineLite,f=!1,w=this,H=new THREE.WebGLRenderer({antialias:!0,autoClear:!0});this.mouse=E,this.renderer=H,this.init=function(){r=i.shuffledDeck(),r[0].position={x:-30,y:0,z:0},r[1].position={x:0,y:0,z:0},r[2].position={x:30,y:0,z:0},r[0].posInfo="what you aspire to",r[1].posInfo="what is standing in your way",r[2].posInfo="how you can overcome this",H.setClearColor(16777215),H.setSize(e.innerWidth/12*10,e.innerHeight/12*10),$("#container-three-sit").append(H.domElement),s=new THREE.Scene,a=new THREE.PerspectiveCamera(35,e.innerWidth/e.innerHeight,1,1e4),a.position.set(0,0,75),s.add(a);var t=new THREE.AmbientLight(16777215);t.position.set(0,0,20),s.add(t);for(var o=new THREE.BoxGeometry(14,24,.2),n=[],p=(new THREE.TextureLoader).load(r[0].image),d=new THREE.MeshBasicMaterial({map:p}),h=0;3>h;h++){var l=(new THREE.TextureLoader).load(r[h].image),y=new THREE.MeshBasicMaterial({map:l}),E=new THREE.Mesh(o,y);E.position.set(-30,10,50),E.rotation.y=Math.PI/2,E.name=r[h].name,E.PKT=r[h].PKT,E.posInfo=r[h].posInfo,E.selected=!1,n.push(E),s.add(E)}u.to(n[0].position,1,r[0].position).to(n[0].rotation,1,{y:Math.PI},"-=1").to(n[1].position,1,r[1].position).to(n[1].rotation,1,{y:Math.PI},"-=1").to(n[2].position,1,r[2].position).to(n[2].rotation,1,{y:Math.PI},"-=1");var m=new THREE.PlaneGeometry(e.innerWidth/12*10,e.innerHeight/12*10),f=new THREE.MeshLambertMaterial({color:16777215,transparent:!0,opacity:0});c=new THREE.Mesh(m,f),c.name="overlay",c.position.set(0,0,-1),s.add(c)},$(e).resize(function(){a.aspect=e.innerWidth/e.innerHeight,a.updateProjectionMatrix(),H.setSize(e.innerWidth/12*10,e.innerHeight/12*10)}),this.intersect=function(e){t(l,E,a);var i=l.intersectObjects(s.children);i.length>0&&o(i[0])};var T=function(){a.position.x=20*E.x,a.position.y=20*E.y,a.lookAt(s.position),w.reqFr=requestAnimationFrame(T),H.render(s,a)};this.render=T,this.destroyScene=function(){cancelAnimationFrame(this.reqFr)}}]);